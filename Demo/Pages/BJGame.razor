@page "/bjgame"
@using Demo.Components
@using Demo.Demos.BJ
@using Demo.Demos.TSM.GeneralGenetic
<link rel="stylesheet" href="css/demos.css" />

<PageTitle>Blackjack</PageTitle>

<div class="page-container casino-style">
    <div class="game-info-container">
        <GameInfo Game="GameInstance" />
    </div>

    <div class="game-area">
        <PlayingHand Hand="GameInstance.DealerHand" class="dealer-hand" />
        <PlayerHands Game="GameInstance" />
    </div>

    <div class="controls-container">
        <BlackJackGameControls Game="GameInstance" />
    </div>
</div>

@code {
    private BlackjackGameBase GameInstance { get; set; } = null!;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        var shoe = new Shoe(DeckFactory.CreateShuffledDecks(6, RandomProvider.Shared).Cards, redCardPosition: 100);
        GameInstance = new BlackjackGameWithPlayer(shoe);
        GameInstance.GameStateChanged += async (isDealerAction) =>
        {
            await HandleGameStateChanged(isDealerAction);
        };
    }

    private async Task HandleGameStateChanged(bool isDealerAction)
    {
        StateHasChanged();
        if (!isDealerAction) return;
        await Task.Delay(1000);
        await Task.Yield();
    }
}


<style>
    :root {
        --gap-size: 10px;
    }

    /* Overall casino-style page layout */
    .page-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        height: calc(100vh - 56px - var(--gap-size));
        padding: 20px;
        background-image: radial-gradient(circle, #0d521d, #096a2b, #046d31);
        background-size: cover;
    }

    /* Game info container at the top right corner */
    .game-info-container {
        position: absolute;
        top: 30px;
        right: 20px;
    }

    /* Game area in the center */
    .game-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-grow: 1;
    }

    /* Controls container at the bottom */
    .controls-container {
        width: 100%;
        display: flex;
        justify-content: center;
        padding: 10px;
        background-color: rgba(0, 0, 0, 0.5);
    }

    /* Styled header */
    h3 {
        font-family: 'Carter One', cursive;
        color: #ffd700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        letter-spacing: 1px;
    }

    /* Card display container */
    .card-display {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    /* Style the card elements */
    .card {
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.7);
        border-radius: 8px;
    }

    /* Parameters styling */
    .parameters-container {
        margin-bottom: var(--gap-size);
    }

    /* General text styling for a more luxurious feel */
    body {
        font-family: 'Roboto', sans-serif;
        color: white;
    }

    /* Add vertical space between dealer hand and player hands */
    .dealer-hand {
        margin-bottom: var(--gap-size);
    }
</style>
